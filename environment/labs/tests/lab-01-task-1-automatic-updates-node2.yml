---
nodes:
  node2:
    type: ssh
    addr: node2:22
    # identity-file: /root/.ssh/id_rsa.pub
    user: root
    pass: 'SVA2024-sHv9jUtAJR5hTgfdZwKa8S'

config:
  nodes:
    - node2

tests:
  check_extension_installed:
    command: dpkg -l
    stdout:
      contains:
        - 'unattended-upgrades'
    exit-code: 0

  check_configuration_file:
    command: cat /etc/apt/apt.conf.d/20auto-upgrades
    stdout:
      contains:
        - 'APT::Periodic::Update-Package-Lists "1";'
        - 'APT::Periodic::Unattended-Upgrade "1";'
    exit-code: 0

  check_service:
    command: systemctl status unattended-upgrades.service
    stdout:
      contains:
        - 'loaded'
        - 'active (running)'
        - 'enabled;'
    exit-code: 0
